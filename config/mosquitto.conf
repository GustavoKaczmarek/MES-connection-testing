# Mosquitto Configuration for MES Internal Broker
# Based on plan: Enable TCP and WebSockets, auth, persistence

# Listeners
listener 1883
allow_anonymous false

listener 9001
protocol websockets
allow_anonymous false

# Authentication and Access Control
password_file /mosquitto/config/pwfile
acl_file /mosquitto/config/aclfile

# Persistence
persistence true
persistence_location /mosquitto/data/
persistence_file mosquitto.db
autosave_interval 1800
autosave_on_changes false

# Logging
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type all
log_timestamp true
connection_messages true
log_timestamp_format %Y-%m-%dT%I:%M:%S

# Default QoS and Retain
max_queued_messages 100
message_size_limit 0
max_inflight_messages 20
max_queued_bytes 0

# Upgrade to TLS in production
# require_certificate false
# cafile /mosquitto/config/ca.crt
# certfile /mosquitto/config/server.crt
# keyfile /mosquitto/config/server.key